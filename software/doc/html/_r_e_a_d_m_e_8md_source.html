<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FRC #4221 Joliet Cyborgs Computer Targetting and Ranging: /home/zog/cyborgs/cyborg_vision/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FRC #4221 Joliet Cyborgs Computer Targetting and Ranging
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/zog/cyborgs/cyborg_vision/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Vision-related code for FRC #4241 vision efforts</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;## Overview</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Architecture is a set of servers collecting information (such as cv_cam for each camera that watches the serial camera output) and sending the sensor data via a UDP packet to the centralized database (cv_db).  In the case of a camera, each cv_cam modules passes robot object and visual field location information to cv_db as well as some identifying information tying this visual information to a specific camera.  Similar processing happens for other sensors (like ultrasonic rangers for example).</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The database maintains lists per sensor with some extra structure for cameras (such as names of identified object with visual coordinate-based values for each record)  Each record is timestamped to sub-millisecond precision so we know precisely when it arrived and was stored.  In the case of cameras, this creates a time-based sequence of camera records maintained for each object the cameras report; other sensors are logged in the same way.  A separate thread prunes the lists based on an overall Time-To-Live (TTL) value to remove old records but still allow access to the latest information from each camera (and potentially other sensors) as well as an averaged set of values based on the TTL.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Another thread responds to querys about the data base to provide up-to-date information about the spatial environment around the robot.  Queries could include:</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;* Does any camera see the &quot;ball&quot; object?</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;* How far away from an obstacle is the front sensor of the robot?</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; This thread will typically communicate with the cv_robo module.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;A third component (cv_robo) will communicate with cv_db and work with the robot code to steer, drive, and otherwise operate the robot based on visual cues.  Cv_robo will act just like a human-operated joystick and move the robot and actuate the appropriate functions based on visual cues (just like a human operator would).  The actual robot driving logic lives here.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;The overall system is designed to operate around at least a pair of JeVois smart cameras using both the CLI API to control and configure the cameras and the serial output providing object-based information.  Overall, the system is fairly independent of the visual processing strategy used so we can delay choosing a visual processing algorithm until we understand the challenge and can even it change it while wr&#39;re working on the roboto or even between events or runs if we are feeling especially bold and confident).  There may be other sensors use to augment the robot&#39;s perception of its environment and its orientation to the field of play and the contents thereof.   </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;## Architecture</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Below is a diagram showing the relationship and connectivity of major parts of the vision-processing system.  Keep in mind that this can grow to be more than just vision; the goal is autonomous operation of the robot and while it&#39;s believed that vision is going to play a key role in this, it&#39;s also very likely that the robot is going to end up growing some sort of &quot;sensor package&quot; to help it get the job done.</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; ![Cyborg-vision Architectural Diagram](https://github.com/cgzog/cyborg_vision/blob/master/cv_arch_diagram.png &quot;Cyborg-vision Architectural Diagram&quot;)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;### Components</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;#### Device Servers</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;These are small, special purpose processes that in general watch a sensor, get it&#39;s current readings (either on a regular interval or whenever the sensor sends it out depending on the behavior of the sensor).</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;They take these values, add some identification information, and send it to the CV Database for logging.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;##### Camera Servers</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;##### Other Sensor Servers</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;The design does not preclude having more sensor servers which can monitor individual or sets of sensors and pass that information to cv_db.  This could include different sensor types such as ultrasonic, light or others sensor types.</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;Each sensor type can have its value stored in same time-tracked manner as the cameras making the most recent values available to the Robot Driver module for consideration in cotrolling the robot.  The format of the data from each sensor type can be defined at the time that sensor is incorporated taking into account the type and richness of the information available from that sensor type.  Each data record will need to include the appropriate sensor identification information so that each specific sensor instance can be mapped into the physical space surrounding the robot.</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;#### Database</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;The Cyborg-Vision Database (cv_db) gets readings from various sensor servers and saves their values.  In addition to saving the values, it also regularly &quot;prunes&quot; the database to remove older values (typically referred to as a TTL, or **T**ime-**t**o-**L**ive).  Whenever it finds values older than the TTL limit, it removes these from the database.  Think of it terms of keeping only the most recent sensor history; who cares what a camera saw 30 seconds ago?  The robot has probably moved, turned, or something else has changed; we mostly want to know what&#39;s happening right now (or at least within only the last few seconds).</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;Processes that want to find out about the conditions around the robot (whether visual, ranging, etc.) can query cv_db and get the status of a specific sensor, a set of sensors, or potentially even an average sensor reading across the values available.</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;#### Robot Driver</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;The Robot Driver (cv_robo) essentially emulates the actions of a human robot operator.  It queries the cv_proc module for appropriate sensor status to get information useful to detecting potential targets, aligning the robot to interact with them, and establish its orientation with the surrounding field of play.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;This will probably be the most complex part of the vision-processing system as it is responsible for mapping this information into the actions a human operator would use to move and actuate the robot.  The programming team will need to work closely with the drive team in order to understand how to effectively move, steer, and otherwise operate the robot.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;The interface to the RoboRIO will be through a serial port.  There will need to be some new code resident on the RoboRIO to interpret commands coming from the cv_robo module and interpret them just like human-generated joystick commands for operating the robot.  There are a few key aspects to consider here:</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;* The command handling module will need to be modified to accept direct commands from the cv_robo module as well as the current joystick interface</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;* The RoboRIO will need to know when autonomous mode is active or not at any given time</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  * Autonomous Start:  Indicate to the cv_robo module that it should start controlling the robot.</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    * Until this time, the vision-processing system can be running and actively scanning the robot&#39;s surroundings</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    * Any potential or incorrect targets detected before the start of autonomous mode can either be explicitly purged from the vision-processing system once the &quot;Start of Autonomous Mode&quot; signal is given to the cv_robo modules</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    * Any potential or incorrect targets detected before the start of autonomous modeAutonomous Active:  Accept command from cv_robo only at this time and ignore other command inputs</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  * Autonomous Inactive:  Accept only human-generated inputs and ignore any commands from the cv_robo module</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  </div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    * Whether or not the cv_robo module needs to be told that autonomous mode is no longer active is something that can be decided later</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    * It seems there would be no negative side effects if the vision-processing system continues to operate during the competition and logs objects it sees as well as other sensor inputs as these might be useful for later analysis</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;#### Visual Status Display</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;This module, cv_status, drives a series of human-visible LEDs on the robot that display the status of different components of the visual-processing system.  The Raspberry Pi used to run the various components of the visual-processing system has a series of output pins that we can use to drive visual indicators.</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;This can provide visual feedback to an observer as to the status and operation of the visual-processing system.  All of the different components can send messages to cv_status to control their respective indicators.</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;### Hardware platform and Environment</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;### Other ideas and considerations</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;#### Logging and Tracing</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;It will be important for each component in the vision-processing system to record information so that post-testing or post-competition, we can analyze how well it worked and potentially improve it for future runs.</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;This information could include:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;* Configuration settings for each component</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;* Messages sent and received from other components of the vision-processing system</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;* Key logic decisions impacting the decisions and operations while in autonomous mode</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;All of this information would need to be timestamped so it can be later correlated and analyzed to get a complete picture of the operation of the vision-processing system.  Syncronization of timestamps between different components should not be a problem since all of the vision-processing system will be running on a single hardware platform supplying the exact same timebase to all components.</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;The logging and tracing information should be stored as text rather than binary to allow a programmer to quickly be able to scan through and understand the output without much additional processing.  This doesn&#39;t mean that we might not want to create other tools to help us correlate or otherwise visualize the vision-processing logs to better understand how it is operating.</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;#### Visual Tracing</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;In addition to logging vision-processing statuses, events, and activity in the log files, it might be useful to include a set of visible indicators on the robot in order to give real-time information about what the vision-processing system is doing at that moment in time.  The Raspberry PI B+ platform provides 20+ GPIO pins (**G**eneral **P**urpose **I**nput/**O**utput) which could be used to drive a series of LEDs on the robot indicating information about what is happening.</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;Each major component could be associated with an appropriate set of LEDs that could indicate appropriate status information such as:</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;* That module has started and is operating</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;* </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;* </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;* </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;*</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;#### Physical Recording</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;During testing and competition activities, it would be very useful to record the robot from several different locations to capture how it physically controls the robot.  If possible, this should be done in a manner that captures the robot in slow motion for more detailed analysis of the physical movements of the robot as well as capturing any Visual Tracing indications.</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;## Key programming concepts to know to understand the code</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;For maximum portability and control, the bulk of the software is written in C.  There are several concepts that are important to know in order to understand and modify the code.</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;These include:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;### #define</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;Understanding the #define directive is an important part in creating readable and maintainable code.  This is really part of a while family of directives including things like #ifdef, #ifndef, #else, #endif, and others.  Good use of these directives gives you the ability to change your code with a compile-time directive (like enabling specific deep debugging output or accommodating platforms differences through platform-specific code for example).</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;They also provide an effective way to define various constants used in your code in a good human-readable way so you&#39;ll very often see them used in that capacity.  For example, the cv_proc module is intended to support two (2) cameras and the code takes that into account.  It&#39;s obvious that there are some parts of the code that need to be aware of that fact.  You could just use the hard-coded value &quot;2&quot; in these places sort of like this:</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;```c</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;int placeToPutStuff[2];</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;```</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;In this case, it&#39;s hard to know why there this array has 2 elements.  Consider this as an alternative:</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;```c</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;#define NUM_OF_CAMERAS</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;int placeToPutStuff[NUM_OF_CAMERAS];</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;```</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;Without even seeing more than that, it&#39;s obvious that this is related to number of cameras defined.  Imagine wanting to change the code from supporting 2 cameras to 3 cameras; it&#39;s easy to update the NUM_OF_CAMERAS #define and change it from 2 to 3 and have a lot of data structures be updated accordingly.  Otherwise you&#39;re left trying to figure out what that &quot;2&quot; means; is it the number of cameras or just something else in the code that there happen to be two of?</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;In addition, you&#39;ll also see them used as a macro for some code that you don&#39;t want to put in a separate function but want to be expanded in-line right in the code without repeating it over and over.  With a #define, you can &quot;define&quot; it once and easily incorporate it where needed - the Camera List data structure lock and unlocking code is a good example of this in the cv_proc code.</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;Some links:</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;* [C/C++ Preprocessors](https://www.geeksforgeeks.org/cc-preprocessors/)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;* [#define Directive (C/C++)](https://docs.microsoft.com/en-us/previous-versions/teas0593(v=vs.140))</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;As a point of information, the term &quot;preprocessor&quot; refers to the compiler pass that first handles all of the #defines and other #something directives before the code is compiled.  Historically this was done by a separate program called the, wait for it, the &quot;preprocessor&quot; though this behavior is built-into many modern compilers (but usually there is an option to see the &quot;pre-processed&quot; code where you can see the code with all of the preprocessor changes which is very handy for debugging more complicated macro definitions.</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;### Structures and Typedefs</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;Structures are a key way in C and C++ to group related variables together.  The combine multiple variables into a data entity that can be stored, passed around in the code, and manipulated in a way that maintains the relationships between the variables there in.</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;For example, a structure in the vision code could look like this:</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;```c</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;struct iSeeYou {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    char thingISee[100];   /  name of the thing I see</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    int  x;                // x coordinate in the camera&#39;s view</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    int  y;                // y coordinate in the camera&#39;s view</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;```</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;This creates a new data type which can be referenced just like a more basic data type - for example, we could declare an array those structures like this:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;```c</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;struct iSeeYou thingsSeen[20];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;```</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;There is a specific syntax to deal with these items - below is an example where we set the X coordinate of the 5th item to 12345:</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;```c</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;thingsSeen[4].x = 12345;   // remember, arrays start at 0!</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;```</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;Typedefs are a lot like structure definitions but they allow us to actually define a new data type - let&#39;s use the above example and create a new data type STUFF_SEEN:</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;```c</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;typedef struct {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    char thingISee[100];   /  name of the thing I see</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    int  x;                // x coordinate in the camera&#39;s view</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    int  y;                // y coordinate in the camera&#39;s view</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;} STUFF_SEEN;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;```</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;This looks a lot like the original structure but we can use it much easier in the code - for example, here&#39;s a declaration of a variable of this new type:</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;```c</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;STUFF_SEEN hey;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;```</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;More details at:</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;* [Structures in C](https://www.geeksforgeeks.org/structures-c/)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;* [Struct (C programming Language)](https://en.wikipedia.org/wiki/Struct_(C_programming_language)))</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;* [C - Structures](https://www.tutorialspoint.com/cprogramming/c_structures.htm)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;### Pointers</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;Pointers are a way to efficiently access memory locations corresponding to variables and structures when using C.  Pointers allow efficient access by &quot;pointing&quot; to code to locations of variables and structures rather than passing entire structures around.  The use of pointers also supports more sophisticated and flexible data structures such as linked lists which in some usages are much more flexible and powerful than arrays (as one example).  Understanding the use of pointers and the processing associated with pointer arithmetic is a requirement for almost any non-trivial C programming effort.</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;Many system and library calls use pointers to pass or return structures so it is very important to have this understanding to make best use of the system call and utility library functions.</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;Here links to some information sources that can help explain pointers:</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;* [Introduction to pointers in C](http://www.circuitstoday.com/introduction-to-pointers-in-c)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;* [Introduction to pointers in Ci (seems to be a popular title for this topic)](https://www.go4expert.com/articles/introduction-pointers-c-t27959/)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;* [Introduction to pointers in C/C++ (video)](https://www.youtube.com/watch?v=h-HBipu_1P0)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;### Linked Lists</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;Linked Lists are a key basic data structure.  Pointers are the easiest (not the only but by far the easiest) way to implement linked lists.  Linked lists provide a flexible mean to connect data records in a way where they can be added, deleted, or reordered without moving large amounts of data by simply changing a few pointers.</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;Here are a few resources to get you up to speed on linked lists:</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;* [C Linked List](https://www.zentut.com/c-tutorial/c-linked-list/)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;* [Introduction to Linked Lists in C/C++](https://www.codeproject.com/articles/641175/%2fArticles%2f641175%2fAn-Introduction-to-Linked-Lists-in-C-Cplusplus)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;* [Linked List Introduction](https://www.geeksforgeeks.org/linked-list-set-1-introduction/)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;### System and Library Calls</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;These are the basic calls to get the operating system to do something for us - open a file, get us some more memory, kill something that&#39;s running, etc.  System calls are the most basic functionality the operating system (Linux, Windows, etc). can provide - you get the most control but at times they can be harder to use.  There are environments that have a very minimal (or maybe even no operating system) like an Arduino, a set of pretty basic routines (like the RoboRio) or a full tilt, crankin&#39; it out operating system like Linux (a Raspberry Pi is a good example of that).</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;Library calls will look very similar and often times cause the operating system to do something as well.  Things that fall into that category are routines like stdio (C) or iostream (C++); these sorts of routines provide an easier to use or more flexible and hide some of the system call complexity (stdio and iostream are perfect examples of that).  They&#39;ll also provide functionality that many programs want to use like string manipulation that while they aren&#39;t things the operating system cares about (&quot;I&#39;m an &#39;OPERATING SYSTEM&#39; friend - I don&#39;t do string comparison!&quot;).</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;There are a lot of function calls that fall into these areas - 100&#39;s at least (at one point I knew pretty much all of them but a lot of water has flowed under the bridge and a lot of routines have been added so that&#39;s probably not the case anymore).  So how do you get started?  I&#39;d start by looking at the code and using one of the good &quot;manpage&quot; sites online (&quot;manpage&quot; is short for manual page so you won&#39;t sound like you&#39;re not hip to the groove that&#39;s being laid down).</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;A good site for Linux manpages is [Man7.org](http://man7.org/linux/man-pages/dir_all_alphabetic.html).</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;Manpages will have standard set of sections that will you understand what&#39;s happening - for system and library calls, you&#39;ll typically see:</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;* **Name**</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;* **Synopsis** (function name, parameters, and return types - if you know what you are doing, a lot of times this is all you need to jar your memory)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;* **Description** (the will provide more information on what it does and what the parameters or options are if it&#39;s not totally obvious)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;* **Return Value** (what you get back if it works as well as if it doesn&#39;t work)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;* **See Also** (cross references to other related functions - the page to &quot;open&quot; something probably has a link to the functions to &quot;close&quot; it or otherwise manipulate it so if you just remember one name, you can get connected to the other complimentary functions just about every time)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;You&#39;ll notice there are numbers involved (we never said there would be no math!); these numbers mean things.  The numbers 2 and 3 are probably the most interesting to software developers as those identify system calls and library functions respectively - these are functions your program can actually call.  Things with number 1 are commands - things you&#39;d type at the Linux command prompt to do something other than calling a function in your program.</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;Here are a few examples:</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;* [string(3)](http://man7.org/linux/man-pages/man3/string.3.html) - various C string functions (there are quite a few)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;* [cp(1)](http://man7.org/linux/man-pages/man1/cp.1.html) - command to copy files and directories; lots of options in the &quot;Description&quot; section</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;### Memory Management</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;Many programming languages relieve the programmer from having to manage memory - that is the need to get memory to put new data and objects into and the need to dispose of it when it&#39;s no longer needed (not disposing of unneeded memory is generally considered a bug; at best your application will just keep growing but at worst, you&#39;ll overwrite or discard the pointer needed to free memory and create what is considered a &quot;memory leak&quot; - these are not considered a feature).  The languages that do this automatically are typically referred to as supporting *automatic garbage collection*; Java is one of those, C isn&#39;t.</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;In C, you allocate memory using the [malloc](https://linux.die.net/man/3/malloc)() function to get more memory (think of it as shorthand for **m**emory **alloc**ation).  This function will make a certain amount of memory available to the program for use.  This memory can be used to store anything, any type of data, for as long as you need to store or (or at least until your program exits at which point any memory used by it it released so it&#39;s not lost *forever* ;).  Malloc() returns a pointer if successful; otherwise it returns 0 (or a NULL pointer in the parlance of C).  This is something your program wants to check for just to make sure something awful hasn&#39;t happened.  The vision processing system has it&#39;s malloc() call in utility.c and is wrapped by a function called cvAlloc().  If a memory allocation ever fails, it&#39;s likely that the situation not just for your program, but potentially for the whole system is, well, grim.  There isn&#39;t a lot you would typically do except for exit if that happens (if you really know what you&#39;re doing and think you&#39;re program can continue, you might want to include logic to try and continue but keep in mind that some other code might want to allocate memory including some library calls which might be much less tolerate of a malloc() failure).</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;Complimentary function to malloc is [free](https://linux.die.net/man/3/malloc)() which takes a pointer returned by malloc() and takes that memory &quot;back&quot; for re-use by the program potentially as the return from a future malloc() call.</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;*Important note*:  Malloc() returns a pointer - when you all free(), you want to pass that *exact* pointer value back.</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;Behind the scenes, there is a memory management routine running that allocates memory for your program in bigger chunks.  This is typically referred to as the *heap*.  The malloc() routine keeps a list of memory addresses it handed out and how big of an area that pointer was associated with.  If you look at the documentation for the calls to malloc(), you&#39;ll see it&#39;s pretty much an all or nothing interface as you either get a pointer back meaning you got what you asked for or you get back nothing.  Likewise, when you call free() with a pointer value you got from a malloc() call, you&#39;re also not passing the size of the amount of memory you&#39;re freeing, just a pointer to it.  The free routines looks into a list of pointers that were already handed out, which include how much memory that pointer was pointing to, and marks it internally as being available.  If you pass a different value, you really gum up the works.  In the pro world, we refer to that as *heap corruption* and done enough times (or honestly just once), it messes up the lists this library call uses to track, manage, and return memory to the point where it could lose track of some memory (creating a dreaded *leak*) or even worse, it could give out some memory *twice* causing some very, very, very hard to find find data corruption bugs (imagine you had two variables, **x** and **y** and somehow they ended up overlapping the memory used to store what you thought were two very simple, completely distinct variables and when you updated one, you subtly altered the value of the other in a program section far, far away.  That will be *very* tough to find.</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;So the pro tip of the day:  make sure you give back what you got, and only what you got, and only once (because free()ing something more than once will also lead to *heap corruption).</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;Some resources for learning more about C memory management:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;* [C - Memory Management](https://www.tutorialspoint.com/cprogramming/c_memory_management.htm)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;* [ Memory Management in C Programming](https://www.tutorialcup.com/cprogramming/memory-management.htm)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;* [ C Memory Management](https://stackoverflow.com/questions/24891/c-memory-management)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;This might all seem like a giant pain but it really isn&#39;t; you actually learn to better appreciate how memory is actually managed and used so even in environments with garbage collection, you&#39;ll create less garbage (the big downside of automatic garbage collection is that when the environment needs to do it, you&#39;re program essentially freezes - not good for situation where you are controlling something in real time; like say, a robot.  Stop processing events on or around your robot at seemingly random times for random amounts of time?  Hello Mr. Wall or have a nice broken part because you sent a command to move something and weren&#39;t able to read the limit switch to stop from breaking something on your robot.  Not good.</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;### Sockets and Networking</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;### Multi-threaded Programming</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;### Recursion</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;* [C - Recursion](https://www.tutorialspoint.com/cprogramming/c_recursion.htm)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;### Locks and Mutexes</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;First off, you need to know how to pronounce &quot;mutex&quot; (syllable break between the &quot;u&quot; and the &quot;t&quot;) - check out how &quot;Julia&quot; pronounces it at [Definitions.net](https://www.definitions.net/pronounce/mutex) - listen *ONLY* to Julia, everyone else is pronouncing it, well, *WRONG* (OK, &quot;Oliver&quot; and &quot;Emily&quot; are pretty solid too but skip the US English dudes for sure as they clearly are not programmers).</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;Mu-tex - OK, now we can move on.</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;## Conclusion</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;There is a lot going on in this design and corresponding code.  Depending on your level of experience with C and the Linux environment, this might be the most complicated code you&#39;ve dealt with to date.  Don&#39;t hesitate to search for and read about some of the topics to learn more; also don&#39;t hesitate to ask me to help explain something as I&#39;ll be glad to do so.</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
